{"remainingRequest":"/node/src/code-factory/node_modules/vue-loader/lib/index.js??vue-loader-options!/node/src/code-factory/lsrkyyezwbvy/src/components/writingPad.vue?vue&type=script&lang=js&","dependencies":[{"path":"/node/src/code-factory/lsrkyyezwbvy/src/components/writingPad.vue","mtime":1649314960041},{"path":"/node/src/code-factory/node_modules/cache-loader/dist/cjs.js","mtime":1648824486287},{"path":"/node/src/code-factory/node_modules/babel-loader/lib/index.js","mtime":1648824338096},{"path":"/node/src/code-factory/node_modules/cache-loader/dist/cjs.js","mtime":1648824486287},{"path":"/node/src/code-factory/node_modules/vue-loader/lib/index.js","mtime":1648824494917}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7YmFzZVVSTH0gZnJvbSAnQC91dGlsL3V0aWwnOwppbXBvcnQgdXBsb2FkIGZyb20gJ0AvY29tcG9uZW50cy91cGxvYWQnCgpleHBvcnQgZGVmYXVsdHsKICBuYW1lOiAnd3JpdGluZ1BhZCcsCglwcm9wczp7CgkJLy8g5pys5Zyw5LiK5LygICDov5jmmK/kuIPniZvkuIrkvKAKICAgIHR5cGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIiwKICAgIH0sCiAgICAvLyDllK/kuIDlgLwKICAgIHV1aWQ6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIiwKICAgIH0sCiAgICAvLyDln5/lkI0KICAgIGRvbWFpbjogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICIiLAogICAgfSwKCQkvLyDmnKzlnLDlrZjlgqjot6/lvoQKCQlzYXZlUGF0aDogewoJCQl0eXBlOiBTdHJpbmcsCgkJCWRlZmF1bHQ6ICcnCgkJfQoJfSwKICBkYXRhKCl7CiAgICByZXR1cm4gewoJCSAgY3R4OiAnJywKCQkJcG9pbnRzOiBbXSwKCQkJY2FudmFzOiAnJywKCQkJdGltZXJPdXQ6IG51bGwsCiAgICAgIHVwbG9hZFVybDogYmFzZVVSTCArICcvcHJvY2Vzcy92MS91cGxvYWRGaWxlJwogICAgfQogIH0sCiAgbWV0aG9kczp7CiAgICBpbml0V3JpdGluZ1BhZCgpewogICAgICBsZXQgY2FudmFzID0gdGhpcy4kcmVmcy5jYW52YXM7CiAgICAgIGNhbnZhcy53aWR0aCA9IHRoaXMuJHJlZnMuY2FudmFzLnBhcmVudE5vZGUuY2xpZW50V2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLiRyZWZzLmNhbnZhcy5wYXJlbnROb2RlLmNsaWVudEhlaWdodDsKICAgICAgdGhpcy5jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gNDsKICAgICAgdGhpcy5jdHgubGluZUNhcCA9ICdyb3VuZCc7CiAgICAgIHRoaXMuY3R4LmxpbmVKb2luID0gJ3JvdW5kJzsKICAgICAgdGhpcy5jYW52YXMgPSB0aGlzLiRyZWZzWydjYW52YXMnXTsKICAgIH0sCiAgICBnZXRNb3VzZVBvcyhjYW52YXMsIGV2dCkgewoJCQl2YXIgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQkJcmV0dXJuIHsKCQkJCXg6IGV2dC5jbGllbnRYIC0gcmVjdC5sZWZ0ICogKHJlY3Qud2lkdGggLyBjYW52YXMud2lkdGgpLAoJCQkJeTogZXZ0LmNsaWVudFkgLSByZWN0LnRvcCAqIChjYW52YXMuaGVpZ2h0IC8gcmVjdC5oZWlnaHQpCgkJCX07CgkJfSwKCQkvKiDngrnlh7vnmoTml7blgJnkv53lrZjkuIvmnaXkvY3nva4KCQkgKiBAcGFyYW0ge2V9IGUg6Ieq5a6a5LmJ5bGe5oCnCgkJICovCgkJbW91c2Vkb3duKGUpIHsKCQkJY29uc3Qgb2JqID0gdGhpcy5nZXRNb3VzZVBvcyhlLnRhcmdldCwgZSk7CgkJCWNvbnN0IHN0YXJ0WCA9IG9iai54OwoJCQljb25zdCBzdGFydFkgPSBvYmoueTsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQljb25zdCBzdGFydFBvaW50ID0gewoJCQkJWDogc3RhcnRYLAoJCQkJWTogc3RhcnRZCgkJCX07CgkJCXRoaXMucG9pbnRzLnB1c2goc3RhcnRQb2ludCk7CgkJCXRoaXMuY3R4LmJlZ2luUGF0aCgpOwoJCX0sCiAgICAvKiDnp7vliqjnmoTml7blgJnkv53lrZjkuIvmnaXkvY1kZAoJCSAqIEBwYXJhbSB7ZX0gZSDoh6rlrprkuYnlsZ7mgKcKCQkgKi8KCQltb3VzZW1vdmUoZSkgewoJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCWlmICh0aGlzLnBvaW50cy5sZW5ndGgpIHsKCQkJCWNvbnN0IG9iaiA9IHRoaXMuZ2V0TW91c2VQb3MoZS50YXJnZXQsIGUpOwoJCQkJbGV0IG1vdmVYID0gb2JqLng7CgkJCQlsZXQgbW92ZVkgPSBvYmoueTsKCQkJCWxldCBtb3ZlUG9pbnQgPSB7CgkJCQkJWDogbW92ZVgsCgkJCQkJWTogbW92ZVkKCQkJCX07CgkJCQl0aGlzLnBvaW50cy5wdXNoKG1vdmVQb2ludCk7IC8v5a2Y54K5CgkJCQlsZXQgbGVuID0gdGhpcy5wb2ludHMubGVuZ3RoOwoJCQkJaWYgKGxlbiA+PSAyKSB7CgkJCQkJdGhpcy5kcmF3KCk7IC8v57uY5Yi26Lev5b6ECgkJCQl9CgkJCX0KCQl9LAogICAgLyog55S7ICovCgkJZHJhdygpIHsKCQkJbGV0IHBvaW50MSA9IHRoaXMucG9pbnRzWzBdOwoJCQlsZXQgcG9pbnQyID0gdGhpcy5wb2ludHNbMV07CgkJCXRoaXMucG9pbnRzLnNoaWZ0KCk7CgkJCXRoaXMuY3R4Lm1vdmVUbyhwb2ludDEuWCwgcG9pbnQxLlkpOwoJCQl0aGlzLmN0eC5saW5lVG8ocG9pbnQyLlgsIHBvaW50Mi5ZKTsKCQkJdGhpcy5jdHguc3Ryb2tlKCk7CgkJfSwKCgkJLyog5riF56m6Y2FudmFzICovCgkJY2xlYXJDYW52YXMoKSB7CgkJCXRoaXMuJG5leHRUaWNrKCgpID0+IHsKCQkJCS8vIOmHjee9rueUu+W4gwoJCQkJdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuJHJlZnNbJ2NhbnZhcyddLndpZHRoLCB0aGlzLiRyZWZzWydjYW52YXMnXS5oZWlnaHQpOwoJCQkJLy8g5riF56m65pWw5o2uCgkJCQl0aGlzLiRlbWl0KCdjaGFuZ2UnLCcnKQoJCQl9KTsKCQl9LAogICAgLyog6Kem5pG457uT5p2f77yM5bCG5pyq57uY5Yi255qE54K55riF56m66Ziy5q2i5a+55ZCO57ut6Lev5b6E5Lqn55Sf5bmy5omwICovCgkJbW91c2V1cCgpIHsKCQkJdGhpcy50aW1lck91dCAmJiBjbGVhclRpbWVvdXQodGhpcy50aW1lck91dCk7CgkJCXRoaXMucG9pbnRzID0gW107CgkJCXRoaXMuJG5leHRUaWNrKCgpID0+IHsKCQkJCWNvbnN0IGJsb2IgPSB0aGlzLmRhdGFVUkx0b0Jsb2IodGhpcy4kcmVmcy5jYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKSk7CgkJCQlibG9iLm5hbWUgPSB0aGlzLiR1dWlkKCkgKyAnd3JpdGluZ1BhZC5wbmcnOwoJCQkJdGhpcy50aW1lck91dCA9IHNldFRpbWVvdXQoKCkgPT4gewoJCQkJCXRoaXMudXBsb2FkRmlsZShibG9iKTsKCQkJCX0sIDEwMDApOwoJCQl9KTsKCQl9LAogICAgLyogYmFzZTY06L2sYmxvYgogICAgKiBAcGFyYW0ge1N0cmluZ30gYmFzZXVybCBiYXNlNjQKICAgICovCiAgICBkYXRhVVJMdG9CbG9iKGJhc2V1cmwpIHsKICAgICAgbGV0IGFyciA9IGJhc2V1cmwuc3BsaXQoJywnKSwKICAgICAgICBtaW1lID0gYXJyWzBdLm1hdGNoKC86KC4qPyk7LylbMV0sCiAgICAgICAgYnN0ciA9IGF0b2IoYXJyWzFdKSwKICAgICAgICBuID0gYnN0ci5sZW5ndGgsCiAgICAgICAgdThhcnIgPSBuZXcgVWludDhBcnJheShuKTsKICAgICAgd2hpbGUgKG4tLSkgewogICAgICAgIHU4YXJyW25dID0gYnN0ci5jaGFyQ29kZUF0KG4pOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgQmxvYihbdThhcnJdLCB7CiAgICAgICAgdHlwZTogbWltZQogICAgICB9KTsKICAgIH0sCiAgICAvKiDkuIrkvKDmlofku7YKCQkgKiBAcGFyYW0ge0Jsb2J9IGZpbGUg5paH5Lu2CgkJICovCgkJdXBsb2FkRmlsZShmaWxlKSB7CgkJCXRoaXMuJHJlZnMudXBsb2FkLnVwbG9hZEZpbGUodHJ1ZSxmaWxlKQoJCX0sCgkJLyog5LiK5Lyg5aSx6LSlICovCgkJdXBsb2FkRXJyb3IoZXJyb3IpewoJCQljb25zb2xlLmxvZyhlcnJvcikKCQl9LAoJCS8qIOS4iuS8oOaIkOWKnyAqLwoJCXVwbG9hZENoYW5nZShmaWxlKXsKCQkJdGhpcy4kZW1pdCgnY2hhbmdlJyxmaWxlKQoJCX0sCgogIH0sCiAgbW91bnRlZCgpewogICAgdGhpcy5pbml0V3JpdGluZ1BhZCgpCiAgfSwKCWNvbXBvbmVudHM6ewoJCXVwbG9hZAoJfQp9Cg=="},{"version":3,"sources":["writingPad.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAkBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"writingPad.vue","sourceRoot":"src/components","sourcesContent":["<template>\n\t<div class=\"writing\" >\n\t\t<div class=\"writing-pad\">\n\t\t\t<canvas class=\"canvas\" ref=\"canvas\" @mousedown=\"mousedown\" @mousemove=\"mousemove\" @mouseup=\"mouseup\"></canvas>\n\t\t</div>\n\t\t<div class=\"writing-clear\" @click=\"clearCanvas\">清除</div>\n\t\t<upload v-show=\"false\" \n\t\t\t:uuid=\"uuid\"\n      :type=\"type\"\n      :domain=\"domain\"\n      :savePath=\"savePath\"\n\t\t\tref=\"upload\"\n\t\t\t@change=\"uploadChange\"\n\t\t\t@error=\"uploadError\"\n\t\t/>\n\t</div>\n</template>\n<script>\nimport {baseURL} from '@/util/util';\nimport upload from '@/components/upload'\n\nexport default{\n  name: 'writingPad',\n\tprops:{\n\t\t// 本地上传  还是七牛上传\n    type: {\n      type: String,\n      default: \"\",\n    },\n    // 唯一值\n    uuid: {\n      type: String,\n      default: \"\",\n    },\n    // 域名\n    domain: {\n      type: String,\n      default: \"\",\n    },\n\t\t// 本地存储路径\n\t\tsavePath: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t}\n\t},\n  data(){\n    return {\n\t\t  ctx: '',\n\t\t\tpoints: [],\n\t\t\tcanvas: '',\n\t\t\ttimerOut: null,\n      uploadUrl: baseURL + '/process/v1/uploadFile'\n    }\n  },\n  methods:{\n    initWritingPad(){\n      let canvas = this.$refs.canvas;\n      canvas.width = this.$refs.canvas.parentNode.clientWidth;\n      canvas.height = this.$refs.canvas.parentNode.clientHeight;\n      this.ctx = canvas.getContext('2d');\n      this.ctx.lineWidth = 4;\n      this.ctx.lineCap = 'round';\n      this.ctx.lineJoin = 'round';\n      this.canvas = this.$refs['canvas'];\n    },\n    getMousePos(canvas, evt) {\n\t\t\tvar rect = canvas.getBoundingClientRect();\n\t\t\treturn {\n\t\t\t\tx: evt.clientX - rect.left * (rect.width / canvas.width),\n\t\t\t\ty: evt.clientY - rect.top * (canvas.height / rect.height)\n\t\t\t};\n\t\t},\n\t\t/* 点击的时候保存下来位置\n\t\t * @param {e} e 自定义属性\n\t\t */\n\t\tmousedown(e) {\n\t\t\tconst obj = this.getMousePos(e.target, e);\n\t\t\tconst startX = obj.x;\n\t\t\tconst startY = obj.y;\n\t\t\te.preventDefault();\n\t\t\tconst startPoint = {\n\t\t\t\tX: startX,\n\t\t\t\tY: startY\n\t\t\t};\n\t\t\tthis.points.push(startPoint);\n\t\t\tthis.ctx.beginPath();\n\t\t},\n    /* 移动的时候保存下来位dd\n\t\t * @param {e} e 自定义属性\n\t\t */\n\t\tmousemove(e) {\n\t\t\te.preventDefault();\n\t\t\tif (this.points.length) {\n\t\t\t\tconst obj = this.getMousePos(e.target, e);\n\t\t\t\tlet moveX = obj.x;\n\t\t\t\tlet moveY = obj.y;\n\t\t\t\tlet movePoint = {\n\t\t\t\t\tX: moveX,\n\t\t\t\t\tY: moveY\n\t\t\t\t};\n\t\t\t\tthis.points.push(movePoint); //存点\n\t\t\t\tlet len = this.points.length;\n\t\t\t\tif (len >= 2) {\n\t\t\t\t\tthis.draw(); //绘制路径\n\t\t\t\t}\n\t\t\t}\n\t\t},\n    /* 画 */\n\t\tdraw() {\n\t\t\tlet point1 = this.points[0];\n\t\t\tlet point2 = this.points[1];\n\t\t\tthis.points.shift();\n\t\t\tthis.ctx.moveTo(point1.X, point1.Y);\n\t\t\tthis.ctx.lineTo(point2.X, point2.Y);\n\t\t\tthis.ctx.stroke();\n\t\t},\n\n\t\t/* 清空canvas */\n\t\tclearCanvas() {\n\t\t\tthis.$nextTick(() => {\n\t\t\t\t// 重置画布\n\t\t\t\tthis.ctx.clearRect(0, 0, this.$refs['canvas'].width, this.$refs['canvas'].height);\n\t\t\t\t// 清空数据\n\t\t\t\tthis.$emit('change','')\n\t\t\t});\n\t\t},\n    /* 触摸结束，将未绘制的点清空防止对后续路径产生干扰 */\n\t\tmouseup() {\n\t\t\tthis.timerOut && clearTimeout(this.timerOut);\n\t\t\tthis.points = [];\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst blob = this.dataURLtoBlob(this.$refs.canvas.toDataURL('image/png'));\n\t\t\t\tblob.name = this.$uuid() + 'writingPad.png';\n\t\t\t\tthis.timerOut = setTimeout(() => {\n\t\t\t\t\tthis.uploadFile(blob);\n\t\t\t\t}, 1000);\n\t\t\t});\n\t\t},\n    /* base64转blob\n    * @param {String} baseurl base64\n    */\n    dataURLtoBlob(baseurl) {\n      let arr = baseurl.split(','),\n        mime = arr[0].match(/:(.*?);/)[1],\n        bstr = atob(arr[1]),\n        n = bstr.length,\n        u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new Blob([u8arr], {\n        type: mime\n      });\n    },\n    /* 上传文件\n\t\t * @param {Blob} file 文件\n\t\t */\n\t\tuploadFile(file) {\n\t\t\tthis.$refs.upload.uploadFile(true,file)\n\t\t},\n\t\t/* 上传失败 */\n\t\tuploadError(error){\n\t\t\tconsole.log(error)\n\t\t},\n\t\t/* 上传成功 */\n\t\tuploadChange(file){\n\t\t\tthis.$emit('change',file)\n\t\t},\n\n  },\n  mounted(){\n    this.initWritingPad()\n  },\n\tcomponents:{\n\t\tupload\n\t}\n}\n</script>\n<style lang=\"less\" scoped>\n  .writing {\n    &-pad {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: calc(100% - 40px);\n      border-bottom: 1px solid #e9eaf0;\n      .canvas {\n        width: 100%;\n        height: 100%;\n      }\n    }\n    &-clear {\n      height: 40px;\n      display: flex;\n      flex-direction: row-reverse;\n      color: @primary-color;\n      align-items: center;\n    }\n  }\n</style>"]}]}