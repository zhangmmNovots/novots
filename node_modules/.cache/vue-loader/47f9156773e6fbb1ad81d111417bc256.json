{"remainingRequest":"/node/src/code-factory/node_modules/vue-loader/lib/index.js??vue-loader-options!/node/src/code-factory/lsrkyyezwbvy/src/components/upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/node/src/code-factory/lsrkyyezwbvy/src/components/upload.vue","mtime":1649314960101},{"path":"/node/src/code-factory/node_modules/cache-loader/dist/cjs.js","mtime":1648824486287},{"path":"/node/src/code-factory/node_modules/babel-loader/lib/index.js","mtime":1648824338096},{"path":"/node/src/code-factory/node_modules/cache-loader/dist/cjs.js","mtime":1648824486287},{"path":"/node/src/code-factory/node_modules/vue-loader/lib/index.js","mtime":1648824494917}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmNvbnN0IHFpbml1ID0gcmVxdWlyZSgicWluaXUtanMiKTsKaW1wb3J0IHsgYmFzZVVSTCB9IGZyb20gIkAvdXRpbC91dGlsIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJ1cGxvYWQiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewoJCQlzaG93UHJvZ3Jlc3M6IGZhbHNlLAoJCQlwcm9ncmVzc1dpZHRoOiAnMCcsCiAgICAgIGNodW5rUGFyYW1zIDogewogICAgICAgICAgZmlsZTonJywgLy8g5re75Yqg5paH5Lu2CiAgICAgICAgICBjaHVua3M6JycsIC8vIOaAu+Wdl+WEv+aVsAogICAgICAgICAgY2h1bms6MCwgLy8g5b2T5YmN56ys5Yeg5Z2X5YS/CiAgICAgICAgICBjaHVua1NpemU6JycsIC8v5b2T5YmN5Z2X5YS/5aSn5bCPCiAgICAgICAgICBuYW1lIDonJywgLy/mlofku7blkI0KICAgICAgICAgIGlkOicnICAvL+WIhueJh+aWh+S7tiAgbWQ1CiAgICAgIH0sCiAgICAgIGJ1ZmZlckxlbmd0aDoxMDI0ICogMTAyNCAqIDQKCQl9OwogIH0sCiAgcHJvcHM6IHsKICAgIC8vIOaUr+aMgeS4iuS8oOaWh+S7tuexu+WeiwogICAgYWNjZXB0OiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogIioiLAogICAgfSwKICAgIC8vIOS4iuS8oOWJjeaWueazlQogICAgYmVmb3JlVXBsb2FkOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uLAogICAgfSwKICAgIC8vIOaYr+WQpuemgeeUqAogICAgZGlzYWJsZWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICB9LAogICAgLy8g5pys5Zyw5LiK5LygICDov5jmmK/kuIPniZvkuIrkvKAKICAgIHR5cGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIiwKICAgIH0sCiAgICAvLyDllK/kuIDlgLwKICAgIHV1aWQ6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIiwKICAgIH0sCiAgICAvLyDln5/lkI0KICAgIGRvbWFpbjogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICIiLAogICAgfSwKCQkvLyDmnKzlnLDlrZjlgqjot6/lvoQKCQlzYXZlUGF0aDogewoJCQl0eXBlOiBTdHJpbmcsCgkJCWRlZmF1bHQ6ICcnCgkJfQogIH0sCiAgbWV0aG9kczogewogICAgLyog5LiK5Lyg5paH5Lu2ICovCiAgICBoYW5kbGVDaGFuZ2UoKSB7CiAgICAgIGNvbnN0IFtmaWxlXSA9IHRoaXMuJHJlZnMuZmlsZS5maWxlczsKICAgICAgY29uc3QgZmxhZyA9IHRoaXMuYmVmb3JlVXBsb2FkKGZpbGUpOwoJCQl0aGlzLnVwbG9hZEZpbGUoZmxhZyxmaWxlKQogICAgfSwKCQl1cGxvYWRGaWxlKGZsYWcsZmlsZSl7CgkJCS8vIOaYr+WQpuWPr+S7peS4iuS8oAogICAgICBpZiAoZmxhZykgewogICAgICAgIC8vIOS4g+eJmwogICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICIyIikgewogICAgICAgICAgdGhpcy5xaW5pdVVwbG9hZCh0aGlzLnV1aWQsIGZpbGUpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy50eXBlID09PSAiMSIpIHsKICAgICAgICAgIHRoaXMuaW5pdHBhcmFtcyhmaWxlKTsKICAgICAgICAgIC8vIOacrOWcsAoJCQkJCXRoaXMuZGVmYXVsdFVwbG9hZChmaWxlKQogICAgICAgIH0KICAgICAgfQoJCX0sCiAgICAvKiDngrnlh7sKICAgICAqIOW8ueWHuumAieaLqeaWh+S7tuahhgogICAgICovCiAgICBoYW5kbGVDbGljaygpIHsKICAgICAgdGhpcy4kcmVmcy5maWxlLmNsaWNrKCk7CiAgICB9LAogICAgLyog6I635Y+W5LiD54mb55qEdG9rZW4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1dWlkIOWUr+S4gOWAvAogICAgICogQHBhcmFtIHtTdHJpbmd9IGZpbGVOYW1lIOaWh+S7tuWQjeensAogICAgICovCiAgICBnZXRRaW5pdVRva2VuKHV1aWQsIGZpbGVOYW1lKSB7CiAgICAgIHJldHVybiB0aGlzLiRnZXQoYC9wcm9jZXNzL3YxL2dldFFuVXBsb2FkVG9rZW4vJHt1dWlkfWAsIHsKICAgICAgICBmaWxlTmFtZSwKICAgICAgfSk7CiAgICB9LAoKICAgIC8qCiAgICAgKiDkuIPniZvkuIrkvKAKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1dWlkIOWUr+S4gOWAvAogICAgICogQHBhcmFtIHtGaWxlfSBmaWxlIOaWh+S7tgogICAgICovCiAgICBhc3luYyBxaW5pdVVwbG9hZCh1dWlkLCBmaWxlKSB7CgkJCS8vIOWfn+WQjeWQjuaYr+WQpuWMheWQqy8KCQkJY29uc3QgZG9tYWluID0gdGhpcy5kb21haW4uc2xpY2UodGhpcy5kb21haW4ubGVuZ3RoIC0gMSx0aGlzLmRvbWFpbi5sZW5ndGgpID09PSAnLycgPyB0aGlzLmRvbWFpbiA6IHRoaXMuZG9tYWluICsgJy8nCgogICAgICAvLyDojrflj5Z0b2tlbgogICAgICBjb25zdCB7IGRhdGE6IHRva2VuIH0gPSBhd2FpdCB0aGlzLmdldFFpbml1VG9rZW4odXVpZCwgZmlsZS5uYW1lKTsKICAgICAgaWYgKCF0b2tlbikgcmV0dXJuOwogICAgICBjb25zdCB0aGF0ID0gdGhpczsKCQkJCiAgICAgIGNvbnN0IG9ic2VydmVyID0gewogICAgICAgIG5leHQocmVzKSB7CiAgICAgICAgICAvLyDlvZPliY3kuIrkvKDov5vluqYKICAgICAgICAgIHRoYXQuJGVtaXQoInByb2dyZXNzIiwgcmVzKTsKCQkJCQl0aGF0LnNob3dQcm9ncmVzcyA9IHRydWUKCQkJCQl0aGF0LnByb2dyZXNzV2lkdGggPSByZXMudG90YWwucGVyY2VudCArICclJwogICAgICAgIH0sCiAgICAgICAgZXJyb3IoZXJyKSB7CiAgICAgICAgICB0aGF0LiRlbWl0KCJlcnJvciIsIGVycik7CiAgICAgICAgfSwKICAgICAgICBjb21wbGV0ZShyZXMpIHsKICAgICAgICAgIHRoYXQuJGVtaXQoImNoYW5nZSIsIHsKICAgICAgICAgICAgdGl0bGU6IGZpbGUubmFtZSwKICAgICAgICAgICAgdXJsOiBkb21haW4gKyByZXMua2V5LAogICAgICAgICAgfSk7CgkJCQkJdGhhdC5zaG93UHJvZ3Jlc3MgPSBmYWxzZQogICAgICAgIH0sCiAgICAgIH07CiAgICAgIC8vIOS4iuS8oOmFjee9rgogICAgICBjb25zdCBjb25maWcgPSB7CiAgICAgICAgdXNlQ2RuRG9tYWluOiB0cnVlLAogICAgICAgIHJlZ2lvbjogcWluaXUucmVnaW9uLnoxLAogICAgICB9OwogICAgICAvLyDmlofku7bphY3nva4KICAgICAgY29uc3QgcHV0RXh0cmEgPSB7CiAgICAgICAgZm5hbWU6IGZpbGUubmFtZSwKICAgICAgfTsKICAgICAgY29uc3Qgb2JzZXJ2YWJsZSA9IHFpbml1LnVwbG9hZChmaWxlLCBmaWxlLm5hbWUsIHRva2VuLCBwdXRFeHRyYSwgY29uZmlnKTsKICAgICAgLy8g5LiK5Lyg5byA5aeLCiAgICAgIG9ic2VydmFibGUuc3Vic2NyaWJlKG9ic2VydmVyKTsKICAgIH0sCiAgICAvKiDovaxmb3JtIOWvueixoSAqLwogICAgc2V0Rm9ybURhdGEoZGF0YSkgewogICAgICBsZXQgcGFyYW1zID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIHBhcmFtcy5hcHBlbmQoa2V5LCBkYXRhW2tleV0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBwYXJhbXM7CiAgICB9ICwKICAgIC8qIOWIneWni+WMluWPguaVsCAqLwogICAgaW5pdHBhcmFtcyhmaWxlKXsKICAgICAgICAvL+iuvue9ruWIhueJh+Wkp+Wwj++8iOWNleS9jUJ5dGXvvIkKICAgICAgICB0aGlzLmNodW5rUGFyYW1zLmNodW5rcyA9IE1hdGguY2VpbChmaWxlLnNpemUgLyB0aGlzLmJ1ZmZlckxlbmd0aCk7CiAgICAgICAgdGhpcy5jaHVua1BhcmFtcyA9IHsKICAgICAgICAgIGZpbGU6JycsIC8vIOa3u+WKoOaWh+S7tgogICAgICAgICAgY2h1bmtzOk1hdGguY2VpbChmaWxlLnNpemUgLyB0aGlzLmJ1ZmZlckxlbmd0aCksIC8vIOaAu+Wdl+WEv+aVsAogICAgICAgICAgY2h1bms6MCwgLy8g5b2T5YmN56ys5Yeg5Z2X5YS/CiAgICAgICAgICBjaHVua1NpemU6dGhpcy5idWZmZXJMZW5ndGgsIC8v5b2T5YmN5Z2X5YS/5aSn5bCPCiAgICAgICAgICBuYW1lIDpmaWxlLm5hbWUsIC8v5paH5Lu25ZCNCiAgICAgICAgICBpZDp0aGlzLiR1dWlkKCkgIC8v5paH5Lu2IOWUr+S4gOagh+ekugogICAgICAgIH0KICAgIH0sCiAgICAvKiDpgJLlvZLkuIrkvKAgKi8KICAgIGRlZXBVcGxvYWQoZmlsZSxsYXN0VXBsb2FkKXsKICAgICAgLy/orqHnrpflvIDlp4vnmoTliIflibLngrksaWR45piv5LiK5Lyg5oiQ5Yqf55qE5YiG54mH5pWw77yM5pyq5LiK5Lyg6L+H5paH5Lu25YiZ5byA5aeL54K55Li6MAogICAgICBsZXQgc3RhcnQgPSB0aGlzLmNodW5rUGFyYW1zLmNodW5rICogdGhpcy5idWZmZXJMZW5ndGg7CiAgICAgIC8v6K6h566X5YiG5Ymy55qE5L2N572uCiAgICAgIGxldCBlbmQgPSBzdGFydCArIHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgICAvL+WmguaenOWIhuWJsueCuei2heWHuuaWh+S7tuWkp+Wwj++8jOWbnumAgOWIhuWJsueCuQogICAgICBpZiAoZW5kID4gZmlsZS5zaXplKSB7ZW5kID0gZmlsZS5zaXplO30KICAgICAgdGhpcy5jaHVua1BhcmFtcy5maWxlID0gZmlsZS5zbGljZShzdGFydCwgZW5kKTsKICAgICAgbGV0IHRvdGFsUGVyY2VudCA9IGxhc3RVcGxvYWQgPyBsYXN0VXBsb2FkIDogMDsKICAgICAgdGhpcy4kcG9zdFBvcm0oCiAgICAgICAgICAgICAgICBgL3Byb2Nlc3MvdjEvZmlsZVVwbG9hZGAsCiAgICAgICAgICAgICAgICB0aGlzLnNldEZvcm1EYXRhKHRoaXMuY2h1bmtQYXJhbXMpLAogICAgICAgICAgICAgICAgLy/ov5vluqbmnaHnmoTlm57osIMKICAgICAgICAgICAgICAocmVzKT0+ewogICAgICAgICAgICAgICAgbGV0IHRlbXAgPSAwOwogICAgICAgICAgICAgICAgaWYocmVzLmxvYWRlZCA9PT0gcmVzLnRvdGFsKXsKICAgICAgICAgICAgICAgICAgdG90YWxQZXJjZW50ICs9IHJlcy50b3RhbAogICAgICAgICAgICAgICAgICB0ZW1wID0gdG90YWxQZXJjZW50CgogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgIHRlbXAgPSB0b3RhbFBlcmNlbnQgKyByZXMubG9hZGVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNob3dQcm9ncmVzcyA9IHRydWU7CiAgICAgICAgCQkgICAgdGhpcy5wcm9ncmVzc1dpZHRoID0gKHRlbXAgLyBmaWxlLnNpemUpICogMTAwICsgJyUnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKS50aGVuKHJlc3VsdD0+ewogICAgICAgICAgICAgIGlmKHJlc3VsdCAmJiByZXN1bHQuZGF0YS5jb2RlID09IDIwMCl7CiAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5kYXRhLnVybCl7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRvbWFpbiA9IHRoaXMuZG9tYWluLnNsaWNlKHRoaXMuZG9tYWluLmxlbmd0aCAtIDEsdGhpcy5kb21haW4ubGVuZ3RoKSA9PT0gJy8nID8gdGhpcy5kb21haW4gOiB0aGlzLmRvbWFpbiArICcvJwogICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCJjaGFuZ2UiLCB7CiAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZmlsZS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgdXJsOiBkb21haW4gKyByZXN1bHQuZGF0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93UHJvZ3Jlc3MgPSBmYWxzZQogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgIHRoaXMuZGVlcFVwbG9hZChmaWxlLHRvdGFsUGVyY2VudCwrK3RoaXMuY2h1bmtQYXJhbXMuY2h1bmspCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCJlcnJvciIsIHJlc3VsdC5kYXRhLm1zZyk7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dQcm9ncmVzcyA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGVycj0+ewogICAgICAgICAgICAgIHRoaXMuJGVtaXQoImVycm9yIiwgJ+WGhemDqOacjeWKoeWZqOmUmeivrycpOwogICAgICAgICAgICB9KQogICAgfSwKICAgIC8qIOm7mOiupOS4iuS8oCAqLwogICAgYXN5bmMgZGVmYXVsdFVwbG9hZChmaWxlKSB7CiAgICAgIGlmKGZpbGUuc2l6ZSA+IHRoaXMuYnVmZmVyTGVuZ3RoKXsKICAgICAgICB0aGlzLmRlZXBVcGxvYWQoZmlsZSkKICAgICAgfWVsc2V7CiAgICAgICAgY29uc3QgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAvLyDmt7vliqDmlofku7YKICAgICAgICBmb3JtZGF0YS5hcHBlbmQoImZpbGUiLCBmaWxlKTsKICAgICAgICAvLyDmt7vliqDlj4LmlbAgdG9rZW4KICAgICAgICBmb3JtZGF0YS5hcHBlbmQoIlRPS0VOIiwgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgidG9rZW4iKSk7CiAgICAgICAgLy8g5pys5Zyw5L+d5a2Y6Lev5b6ECiAgICAgICAgZm9ybWRhdGEuYXBwZW5kKCdzYXZlUGF0aCcsdGhpcy5zYXZlUGF0aCkKICAgICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgPT4gewogICAgICAgICAgLy8g5aaC5p6c5a6M5oiQCiAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQgJiYgeGhyLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnN0IHJlcyA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKTsKICAgICAgICAJCXRoaXMuJGVtaXQoJ2NoYW5nZScscmVzLmRhdGEpCiAgICAgICAgCQl0aGlzLnNob3dQcm9ncmVzcyA9IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBldmVudCA9PiB7CiAgICAgICAgCWlmIChldmVudC5sZW5ndGhDb21wdXRhYmxlKSB7CiAgICAgICAgCQljb25zdCBwZXJjZW50ID0gKGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsKSAqIDEwMCArICclJzsKICAgICAgICAJCXRoaXMuc2hvd1Byb2dyZXNzID0gdHJ1ZQogICAgICAgIAkJdGhpcy5wcm9ncmVzc1dpZHRoID0gcGVyY2VudAogICAgICAgIAl9CiAgICAgICAgfTsKICAgICAgICB4aHIub3BlbigicG9zdCIsIGJhc2VVUkwgKyAiL3Byb2Nlc3MvdjEvdXBsb2FkRmlsZSIsIHRydWUpOwogICAgICAgIHhoci5zZW5kKGZvcm1kYXRhKTsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upload.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <div @click=\"handleClick\">\n      <slot />\n    </div>\n\t\t<div class=\"progress\" :style=\"{width: progressWidth}\" v-if=\"showProgress\"></div>\n    <input\n      ref=\"file\"\n      v-show=\"false\"\n      type=\"file\"\n      :accept=\"accept\"\n      @change=\"handleChange\"\n\t\t\t:disabled=\"disabled\"\n    />\n  </div>\n</template>\n\n<script>\nconst qiniu = require(\"qiniu-js\");\nimport { baseURL } from \"@/util/util\";\nexport default {\n  name: \"upload\",\n  data() {\n    return {\n\t\t\tshowProgress: false,\n\t\t\tprogressWidth: '0',\n      chunkParams : {\n          file:'', // 添加文件\n          chunks:'', // 总块儿数\n          chunk:0, // 当前第几块儿\n          chunkSize:'', //当前块儿大小\n          name :'', //文件名\n          id:''  //分片文件  md5\n      },\n      bufferLength:1024 * 1024 * 4\n\t\t};\n  },\n  props: {\n    // 支持上传文件类型\n    accept: {\n      type: String,\n      default: \"*\",\n    },\n    // 上传前方法\n    beforeUpload: {\n      type: Function,\n    },\n    // 是否禁用\n    disabled: {\n      type: Boolean,\n      default: false,\n    },\n    // 本地上传  还是七牛上传\n    type: {\n      type: String,\n      default: \"\",\n    },\n    // 唯一值\n    uuid: {\n      type: String,\n      default: \"\",\n    },\n    // 域名\n    domain: {\n      type: String,\n      default: \"\",\n    },\n\t\t// 本地存储路径\n\t\tsavePath: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t}\n  },\n  methods: {\n    /* 上传文件 */\n    handleChange() {\n      const [file] = this.$refs.file.files;\n      const flag = this.beforeUpload(file);\n\t\t\tthis.uploadFile(flag,file)\n    },\n\t\tuploadFile(flag,file){\n\t\t\t// 是否可以上传\n      if (flag) {\n        // 七牛\n        if (this.type === \"2\") {\n          this.qiniuUpload(this.uuid, file);\n        } else if (this.type === \"1\") {\n          this.initparams(file);\n          // 本地\n\t\t\t\t\tthis.defaultUpload(file)\n        }\n      }\n\t\t},\n    /* 点击\n     * 弹出选择文件框\n     */\n    handleClick() {\n      this.$refs.file.click();\n    },\n    /* 获取七牛的token\n     * @param {String} uuid 唯一值\n     * @param {String} fileName 文件名称\n     */\n    getQiniuToken(uuid, fileName) {\n      return this.$get(`/process/v1/getQnUploadToken/${uuid}`, {\n        fileName,\n      });\n    },\n\n    /*\n     * 七牛上传\n     * @param {String} uuid 唯一值\n     * @param {File} file 文件\n     */\n    async qiniuUpload(uuid, file) {\n\t\t\t// 域名后是否包含/\n\t\t\tconst domain = this.domain.slice(this.domain.length - 1,this.domain.length) === '/' ? this.domain : this.domain + '/'\n\n      // 获取token\n      const { data: token } = await this.getQiniuToken(uuid, file.name);\n      if (!token) return;\n      const that = this;\n\t\t\t\n      const observer = {\n        next(res) {\n          // 当前上传进度\n          that.$emit(\"progress\", res);\n\t\t\t\t\tthat.showProgress = true\n\t\t\t\t\tthat.progressWidth = res.total.percent + '%'\n        },\n        error(err) {\n          that.$emit(\"error\", err);\n        },\n        complete(res) {\n          that.$emit(\"change\", {\n            title: file.name,\n            url: domain + res.key,\n          });\n\t\t\t\t\tthat.showProgress = false\n        },\n      };\n      // 上传配置\n      const config = {\n        useCdnDomain: true,\n        region: qiniu.region.z1,\n      };\n      // 文件配置\n      const putExtra = {\n        fname: file.name,\n      };\n      const observable = qiniu.upload(file, file.name, token, putExtra, config);\n      // 上传开始\n      observable.subscribe(observer);\n    },\n    /* 转form 对象 */\n    setFormData(data) {\n      let params = new FormData();\n      if (data) {\n        Object.keys(data).forEach(function(key) {\n          params.append(key, data[key]);\n        });\n      }\n      return params;\n    } ,\n    /* 初始化参数 */\n    initparams(file){\n        //设置分片大小（单位Byte）\n        this.chunkParams.chunks = Math.ceil(file.size / this.bufferLength);\n        this.chunkParams = {\n          file:'', // 添加文件\n          chunks:Math.ceil(file.size / this.bufferLength), // 总块儿数\n          chunk:0, // 当前第几块儿\n          chunkSize:this.bufferLength, //当前块儿大小\n          name :file.name, //文件名\n          id:this.$uuid()  //文件 唯一标示\n        }\n    },\n    /* 递归上传 */\n    deepUpload(file,lastUpload){\n      //计算开始的切割点,idx是上传成功的分片数，未上传过文件则开始点为0\n      let start = this.chunkParams.chunk * this.bufferLength;\n      //计算分割的位置\n      let end = start + this.bufferLength;\n      //如果分割点超出文件大小，回退分割点\n      if (end > file.size) {end = file.size;}\n      this.chunkParams.file = file.slice(start, end);\n      let totalPercent = lastUpload ? lastUpload : 0;\n      this.$postPorm(\n                `/process/v1/fileUpload`,\n                this.setFormData(this.chunkParams),\n                //进度条的回调\n              (res)=>{\n                let temp = 0;\n                if(res.loaded === res.total){\n                  totalPercent += res.total\n                  temp = totalPercent\n\n                }else{\n                  temp = totalPercent + res.loaded\n                }\n                this.showProgress = true;\n        \t\t    this.progressWidth = (temp / file.size) * 100 + '%';\n              }\n            ).then(result=>{\n              if(result && result.data.code == 200){\n                if(result.data.data.url){\n                  const domain = this.domain.slice(this.domain.length - 1,this.domain.length) === '/' ? this.domain : this.domain + '/'\n                  this.$emit(\"change\", {\n                      title: file.name,\n                      url: domain + result.data.data.url,\n                    });\n                  this.showProgress = false\n                }else{\n                  this.deepUpload(file,totalPercent,++this.chunkParams.chunk)\n                }\n              }else{\n                this.$emit(\"error\", result.data.msg);\n                this.showProgress = false;\n              }\n          }).catch(err=>{\n              this.$emit(\"error\", '内部服务器错误');\n            })\n    },\n    /* 默认上传 */\n    async defaultUpload(file) {\n      if(file.size > this.bufferLength){\n        this.deepUpload(file)\n      }else{\n        const formdata = new FormData();\n        // 添加文件\n        formdata.append(\"file\", file);\n        // 添加参数 token\n        formdata.append(\"TOKEN\", sessionStorage.getItem(\"token\"));\n        // 本地保存路径\n        formdata.append('savePath',this.savePath)\n        const xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = () => {\n          // 如果完成\n          if (xhr.readyState === 4 && xhr.status === 200) {\n            const res = JSON.parse(xhr.response);\n        \t\tthis.$emit('change',res.data)\n        \t\tthis.showProgress = false\n          }\n        };\n        xhr.upload.onprogress = event => {\n        \tif (event.lengthComputable) {\n        \t\tconst percent = (event.loaded / event.total) * 100 + '%';\n        \t\tthis.showProgress = true\n        \t\tthis.progressWidth = percent\n        \t}\n        };\n        xhr.open(\"post\", baseURL + \"/process/v1/uploadFile\", true);\n        xhr.send(formdata);\n      }\n    },\n  },\n};\n</script>\n<style scoped lang=\"less\">\n\t.progress{\n\t\theight: 2px;\n\t\tbackground: #66cc3a;\n\t}\n</style>"]}]}