{"remainingRequest":"/node/src/code-factory/node_modules/babel-loader/lib/index.js!/node/src/code-factory/node_modules/cache-loader/dist/cjs.js??ref--1-0!/node/src/code-factory/node_modules/vue-loader/lib/index.js??vue-loader-options!/node/src/code-factory/lsrkyyezwbvy/src/components/upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/node/src/code-factory/lsrkyyezwbvy/src/components/upload.vue","mtime":1649314960101},{"path":"/node/src/code-factory/lsrkyyezwbvy/babel.config.js","mtime":1649314958358},{"path":"/node/src/code-factory/node_modules/cache-loader/dist/cjs.js","mtime":1648824486287},{"path":"/node/src/code-factory/node_modules/babel-loader/lib/index.js","mtime":1648824338096},{"path":"/node/src/code-factory/node_modules/cache-loader/dist/cjs.js","mtime":1648824486287},{"path":"/node/src/code-factory/node_modules/vue-loader/lib/index.js","mtime":1648824494917}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9ub2RlL3NyYy9jb2RlLWZhY3Rvcnkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgX3NsaWNlZFRvQXJyYXkgZnJvbSAiL25vZGUvc3JjL2NvZGUtZmFjdG9yeS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheS5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CgovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwp2YXIgcWluaXUgPSByZXF1aXJlKCJxaW5pdS1qcyIpOwoKaW1wb3J0IHsgYmFzZVVSTCB9IGZyb20gIkAvdXRpbC91dGlsIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJ1cGxvYWQiLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93UHJvZ3Jlc3M6IGZhbHNlLAogICAgICBwcm9ncmVzc1dpZHRoOiAnMCcsCiAgICAgIGNodW5rUGFyYW1zOiB7CiAgICAgICAgZmlsZTogJycsCiAgICAgICAgLy8g5re75Yqg5paH5Lu2CiAgICAgICAgY2h1bmtzOiAnJywKICAgICAgICAvLyDmgLvlnZflhL/mlbAKICAgICAgICBjaHVuazogMCwKICAgICAgICAvLyDlvZPliY3nrKzlh6DlnZflhL8KICAgICAgICBjaHVua1NpemU6ICcnLAogICAgICAgIC8v5b2T5YmN5Z2X5YS/5aSn5bCPCiAgICAgICAgbmFtZTogJycsCiAgICAgICAgLy/mlofku7blkI0KICAgICAgICBpZDogJycgLy/liIbniYfmlofku7YgIG1kNQoKICAgICAgfSwKICAgICAgYnVmZmVyTGVuZ3RoOiAxMDI0ICogMTAyNCAqIDQKICAgIH07CiAgfSwKICBwcm9wczogewogICAgLy8g5pSv5oyB5LiK5Lyg5paH5Lu257G75Z6LCiAgICBhY2NlcHQ6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiKiIKICAgIH0sCiAgICAvLyDkuIrkvKDliY3mlrnms5UKICAgIGJlZm9yZVVwbG9hZDogewogICAgICB0eXBlOiBGdW5jdGlvbgogICAgfSwKICAgIC8vIOaYr+WQpuemgeeUqAogICAgZGlzYWJsZWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICAvLyDmnKzlnLDkuIrkvKAgIOi/mOaYr+S4g+eJm+S4iuS8oAogICAgdHlwZTogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICIiCiAgICB9LAogICAgLy8g5ZSv5LiA5YC8CiAgICB1dWlkOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogIiIKICAgIH0sCiAgICAvLyDln5/lkI0KICAgIGRvbWFpbjogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICIiCiAgICB9LAogICAgLy8g5pys5Zyw5a2Y5YKo6Lev5b6ECiAgICBzYXZlUGF0aDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICcnCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAvKiDkuIrkvKDmlofku7YgKi8KICAgIGhhbmRsZUNoYW5nZTogZnVuY3Rpb24gaGFuZGxlQ2hhbmdlKCkgewogICAgICB2YXIgX3RoaXMkJHJlZnMkZmlsZSRmaWxlID0gX3NsaWNlZFRvQXJyYXkodGhpcy4kcmVmcy5maWxlLmZpbGVzLCAxKSwKICAgICAgICAgIGZpbGUgPSBfdGhpcyQkcmVmcyRmaWxlJGZpbGVbMF07CgogICAgICB2YXIgZmxhZyA9IHRoaXMuYmVmb3JlVXBsb2FkKGZpbGUpOwogICAgICB0aGlzLnVwbG9hZEZpbGUoZmxhZywgZmlsZSk7CiAgICB9LAogICAgdXBsb2FkRmlsZTogZnVuY3Rpb24gdXBsb2FkRmlsZShmbGFnLCBmaWxlKSB7CiAgICAgIC8vIOaYr+WQpuWPr+S7peS4iuS8oAogICAgICBpZiAoZmxhZykgewogICAgICAgIC8vIOS4g+eJmwogICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICIyIikgewogICAgICAgICAgdGhpcy5xaW5pdVVwbG9hZCh0aGlzLnV1aWQsIGZpbGUpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy50eXBlID09PSAiMSIpIHsKICAgICAgICAgIHRoaXMuaW5pdHBhcmFtcyhmaWxlKTsgLy8g5pys5ZywCgogICAgICAgICAgdGhpcy5kZWZhdWx0VXBsb2FkKGZpbGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKiDngrnlh7sKICAgICAqIOW8ueWHuumAieaLqeaWh+S7tuahhgogICAgICovCiAgICBoYW5kbGVDbGljazogZnVuY3Rpb24gaGFuZGxlQ2xpY2soKSB7CiAgICAgIHRoaXMuJHJlZnMuZmlsZS5jbGljaygpOwogICAgfSwKCiAgICAvKiDojrflj5bkuIPniZvnmoR0b2tlbgogICAgICogQHBhcmFtIHtTdHJpbmd9IHV1aWQg5ZSv5LiA5YC8CiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZmlsZU5hbWUg5paH5Lu25ZCN56ewCiAgICAgKi8KICAgIGdldFFpbml1VG9rZW46IGZ1bmN0aW9uIGdldFFpbml1VG9rZW4odXVpZCwgZmlsZU5hbWUpIHsKICAgICAgcmV0dXJuIHRoaXMuJGdldCgiL3Byb2Nlc3MvdjEvZ2V0UW5VcGxvYWRUb2tlbi8iLmNvbmNhdCh1dWlkKSwgewogICAgICAgIGZpbGVOYW1lOiBmaWxlTmFtZQogICAgICB9KTsKICAgIH0sCgogICAgLyoKICAgICAqIOS4g+eJm+S4iuS8oAogICAgICogQHBhcmFtIHtTdHJpbmd9IHV1aWQg5ZSv5LiA5YC8CiAgICAgKiBAcGFyYW0ge0ZpbGV9IGZpbGUg5paH5Lu2CiAgICAgKi8KICAgIHFpbml1VXBsb2FkOiBmdW5jdGlvbiBxaW5pdVVwbG9hZCh1dWlkLCBmaWxlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBkb21haW4sIF95aWVsZCRfdGhpcyRnZXRRaW5pdSwgdG9rZW4sIHRoYXQsIG9ic2VydmVyLCBjb25maWcsIHB1dEV4dHJhLCBvYnNlcnZhYmxlOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAvLyDln5/lkI3lkI7mmK/lkKbljIXlkKsvCiAgICAgICAgICAgICAgICBkb21haW4gPSBfdGhpcy5kb21haW4uc2xpY2UoX3RoaXMuZG9tYWluLmxlbmd0aCAtIDEsIF90aGlzLmRvbWFpbi5sZW5ndGgpID09PSAnLycgPyBfdGhpcy5kb21haW4gOiBfdGhpcy5kb21haW4gKyAnLyc7IC8vIOiOt+WPlnRva2VuCgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0UWluaXVUb2tlbih1dWlkLCBmaWxlLm5hbWUpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkX3RoaXMkZ2V0UWluaXUgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgdG9rZW4gPSBfeWllbGQkX3RoaXMkZ2V0UWluaXUuZGF0YTsKCiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICB0aGF0ID0gX3RoaXM7CiAgICAgICAgICAgICAgICBvYnNlcnZlciA9IHsKICAgICAgICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dChyZXMpIHsKICAgICAgICAgICAgICAgICAgICAvLyDlvZPliY3kuIrkvKDov5vluqYKICAgICAgICAgICAgICAgICAgICB0aGF0LiRlbWl0KCJwcm9ncmVzcyIsIHJlcyk7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5zaG93UHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHRoYXQucHJvZ3Jlc3NXaWR0aCA9IHJlcy50b3RhbC5wZXJjZW50ICsgJyUnOwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gZXJyb3IoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC4kZW1pdCgiZXJyb3IiLCBlcnIpOwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC4kZW1pdCgiY2hhbmdlIiwgewogICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGZpbGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgIHVybDogZG9tYWluICsgcmVzLmtleQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoYXQuc2hvd1Byb2dyZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07IC8vIOS4iuS8oOmFjee9rgoKICAgICAgICAgICAgICAgIGNvbmZpZyA9IHsKICAgICAgICAgICAgICAgICAgdXNlQ2RuRG9tYWluOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWdpb246IHFpbml1LnJlZ2lvbi56MQogICAgICAgICAgICAgICAgfTsgLy8g5paH5Lu26YWN572uCgogICAgICAgICAgICAgICAgcHV0RXh0cmEgPSB7CiAgICAgICAgICAgICAgICAgIGZuYW1lOiBmaWxlLm5hbWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBvYnNlcnZhYmxlID0gcWluaXUudXBsb2FkKGZpbGUsIGZpbGUubmFtZSwgdG9rZW4sIHB1dEV4dHJhLCBjb25maWcpOyAvLyDkuIrkvKDlvIDlp4sKCiAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLnN1YnNjcmliZShvYnNlcnZlcik7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qIOi9rGZvcm0g5a+56LGhICovCiAgICBzZXRGb3JtRGF0YTogZnVuY3Rpb24gc2V0Rm9ybURhdGEoZGF0YSkgewogICAgICB2YXIgcGFyYW1zID0gbmV3IEZvcm1EYXRhKCk7CgogICAgICBpZiAoZGF0YSkgewogICAgICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgcGFyYW1zLmFwcGVuZChrZXksIGRhdGFba2V5XSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwYXJhbXM7CiAgICB9LAoKICAgIC8qIOWIneWni+WMluWPguaVsCAqLwogICAgaW5pdHBhcmFtczogZnVuY3Rpb24gaW5pdHBhcmFtcyhmaWxlKSB7CiAgICAgIC8v6K6+572u5YiG54mH5aSn5bCP77yI5Y2V5L2NQnl0Ze+8iQogICAgICB0aGlzLmNodW5rUGFyYW1zLmNodW5rcyA9IE1hdGguY2VpbChmaWxlLnNpemUgLyB0aGlzLmJ1ZmZlckxlbmd0aCk7CiAgICAgIHRoaXMuY2h1bmtQYXJhbXMgPSB7CiAgICAgICAgZmlsZTogJycsCiAgICAgICAgLy8g5re75Yqg5paH5Lu2CiAgICAgICAgY2h1bmtzOiBNYXRoLmNlaWwoZmlsZS5zaXplIC8gdGhpcy5idWZmZXJMZW5ndGgpLAogICAgICAgIC8vIOaAu+Wdl+WEv+aVsAogICAgICAgIGNodW5rOiAwLAogICAgICAgIC8vIOW9k+WJjeesrOWHoOWdl+WEvwogICAgICAgIGNodW5rU2l6ZTogdGhpcy5idWZmZXJMZW5ndGgsCiAgICAgICAgLy/lvZPliY3lnZflhL/lpKflsI8KICAgICAgICBuYW1lOiBmaWxlLm5hbWUsCiAgICAgICAgLy/mlofku7blkI0KICAgICAgICBpZDogdGhpcy4kdXVpZCgpIC8v5paH5Lu2IOWUr+S4gOagh+ekugoKICAgICAgfTsKICAgIH0sCgogICAgLyog6YCS5b2S5LiK5LygICovCiAgICBkZWVwVXBsb2FkOiBmdW5jdGlvbiBkZWVwVXBsb2FkKGZpbGUsIGxhc3RVcGxvYWQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvL+iuoeeul+W8gOWni+eahOWIh+WJsueCuSxpZHjmmK/kuIrkvKDmiJDlip/nmoTliIbniYfmlbDvvIzmnKrkuIrkvKDov4fmlofku7bliJnlvIDlp4vngrnkuLowCiAgICAgIHZhciBzdGFydCA9IHRoaXMuY2h1bmtQYXJhbXMuY2h1bmsgKiB0aGlzLmJ1ZmZlckxlbmd0aDsgLy/orqHnrpfliIblibLnmoTkvY3nva4KCiAgICAgIHZhciBlbmQgPSBzdGFydCArIHRoaXMuYnVmZmVyTGVuZ3RoOyAvL+WmguaenOWIhuWJsueCuei2heWHuuaWh+S7tuWkp+Wwj++8jOWbnumAgOWIhuWJsueCuQoKICAgICAgaWYgKGVuZCA+IGZpbGUuc2l6ZSkgewogICAgICAgIGVuZCA9IGZpbGUuc2l6ZTsKICAgICAgfQoKICAgICAgdGhpcy5jaHVua1BhcmFtcy5maWxlID0gZmlsZS5zbGljZShzdGFydCwgZW5kKTsKICAgICAgdmFyIHRvdGFsUGVyY2VudCA9IGxhc3RVcGxvYWQgPyBsYXN0VXBsb2FkIDogMDsKICAgICAgdGhpcy4kcG9zdFBvcm0oIi9wcm9jZXNzL3YxL2ZpbGVVcGxvYWQiLCB0aGlzLnNldEZvcm1EYXRhKHRoaXMuY2h1bmtQYXJhbXMpLCAvL+i/m+W6puadoeeahOWbnuiwgwogICAgICBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgdmFyIHRlbXAgPSAwOwoKICAgICAgICBpZiAocmVzLmxvYWRlZCA9PT0gcmVzLnRvdGFsKSB7CiAgICAgICAgICB0b3RhbFBlcmNlbnQgKz0gcmVzLnRvdGFsOwogICAgICAgICAgdGVtcCA9IHRvdGFsUGVyY2VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGVtcCA9IHRvdGFsUGVyY2VudCArIHJlcy5sb2FkZWQ7CiAgICAgICAgfQoKICAgICAgICBfdGhpczIuc2hvd1Byb2dyZXNzID0gdHJ1ZTsKICAgICAgICBfdGhpczIucHJvZ3Jlc3NXaWR0aCA9IHRlbXAgLyBmaWxlLnNpemUgKiAxMDAgKyAnJSc7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmRhdGEuY29kZSA9PSAyMDApIHsKICAgICAgICAgIGlmIChyZXN1bHQuZGF0YS5kYXRhLnVybCkgewogICAgICAgICAgICB2YXIgZG9tYWluID0gX3RoaXMyLmRvbWFpbi5zbGljZShfdGhpczIuZG9tYWluLmxlbmd0aCAtIDEsIF90aGlzMi5kb21haW4ubGVuZ3RoKSA9PT0gJy8nID8gX3RoaXMyLmRvbWFpbiA6IF90aGlzMi5kb21haW4gKyAnLyc7CgogICAgICAgICAgICBfdGhpczIuJGVtaXQoImNoYW5nZSIsIHsKICAgICAgICAgICAgICB0aXRsZTogZmlsZS5uYW1lLAogICAgICAgICAgICAgIHVybDogZG9tYWluICsgcmVzdWx0LmRhdGEuZGF0YS51cmwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczIuc2hvd1Byb2dyZXNzID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczIuZGVlcFVwbG9hZChmaWxlLCB0b3RhbFBlcmNlbnQsICsrX3RoaXMyLmNodW5rUGFyYW1zLmNodW5rKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyLiRlbWl0KCJlcnJvciIsIHJlc3VsdC5kYXRhLm1zZyk7CgogICAgICAgICAgX3RoaXMyLnNob3dQcm9ncmVzcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIF90aGlzMi4kZW1pdCgiZXJyb3IiLCAn5YaF6YOo5pyN5Yqh5Zmo6ZSZ6K+vJyk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKiDpu5jorqTkuIrkvKAgKi8KICAgIGRlZmF1bHRVcGxvYWQ6IGZ1bmN0aW9uIGRlZmF1bHRVcGxvYWQoZmlsZSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBmb3JtZGF0YSwgeGhyOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoZmlsZS5zaXplID4gX3RoaXMzLmJ1ZmZlckxlbmd0aCkgewogICAgICAgICAgICAgICAgICBfdGhpczMuZGVlcFVwbG9hZChmaWxlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGZvcm1kYXRhID0gbmV3IEZvcm1EYXRhKCk7IC8vIOa3u+WKoOaWh+S7tgoKICAgICAgICAgICAgICAgICAgZm9ybWRhdGEuYXBwZW5kKCJmaWxlIiwgZmlsZSk7IC8vIOa3u+WKoOWPguaVsCB0b2tlbgoKICAgICAgICAgICAgICAgICAgZm9ybWRhdGEuYXBwZW5kKCJUT0tFTiIsIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInRva2VuIikpOyAvLyDmnKzlnLDkv53lrZjot6/lvoQKCiAgICAgICAgICAgICAgICAgIGZvcm1kYXRhLmFwcGVuZCgnc2F2ZVBhdGgnLCBfdGhpczMuc2F2ZVBhdGgpOwogICAgICAgICAgICAgICAgICB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICAgICAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5a6M5oiQCiAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0ICYmIHhoci5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczMuJGVtaXQoJ2NoYW5nZScsIHJlcy5kYXRhKTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczMuc2hvd1Byb2dyZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Lmxlbmd0aENvbXB1dGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBwZXJjZW50ID0gZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwgKiAxMDAgKyAnJSc7CiAgICAgICAgICAgICAgICAgICAgICBfdGhpczMuc2hvd1Byb2dyZXNzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzMy5wcm9ncmVzc1dpZHRoID0gcGVyY2VudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICB4aHIub3BlbigicG9zdCIsIGJhc2VVUkwgKyAiL3Byb2Nlc3MvdjEvdXBsb2FkRmlsZSIsIHRydWUpOwogICAgICAgICAgICAgICAgICB4aHIuc2VuZChmb3JtZGF0YSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKSgpOwogICAgfQogIH0KfTs="},{"version":3,"mappings":"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","names":["name","data","showProgress","progressWidth","chunkParams","file","chunks","chunk","chunkSize","id","bufferLength","props","accept","type","default","beforeUpload","disabled","uuid","domain","savePath","methods","handleChange","uploadFile","flag","handleClick","getQiniuToken","fileName","qiniuUpload","token","that","observer","next","res","error","err","complete","title","url","config","useCdnDomain","region","putExtra","fname","observable","qiniu","setFormData","Object","params","initparams","deepUpload","lastUpload","end","totalPercent","temp","then","catch","defaultUpload","formdata","xhr"],"sourceRoot":"src/components","sources":["upload.vue"],"sourcesContent":["<template>\n  <div>\n    <div @click=\"handleClick\">\n      <slot />\n    </div>\n\t\t<div class=\"progress\" :style=\"{width: progressWidth}\" v-if=\"showProgress\"></div>\n    <input\n      ref=\"file\"\n      v-show=\"false\"\n      type=\"file\"\n      :accept=\"accept\"\n      @change=\"handleChange\"\n\t\t\t:disabled=\"disabled\"\n    />\n  </div>\n</template>\n\n<script>\nconst qiniu = require(\"qiniu-js\");\nimport { baseURL } from \"@/util/util\";\nexport default {\n  name: \"upload\",\n  data() {\n    return {\n\t\t\tshowProgress: false,\n\t\t\tprogressWidth: '0',\n      chunkParams : {\n          file:'', // 添加文件\n          chunks:'', // 总块儿数\n          chunk:0, // 当前第几块儿\n          chunkSize:'', //当前块儿大小\n          name :'', //文件名\n          id:''  //分片文件  md5\n      },\n      bufferLength:1024 * 1024 * 4\n\t\t};\n  },\n  props: {\n    // 支持上传文件类型\n    accept: {\n      type: String,\n      default: \"*\",\n    },\n    // 上传前方法\n    beforeUpload: {\n      type: Function,\n    },\n    // 是否禁用\n    disabled: {\n      type: Boolean,\n      default: false,\n    },\n    // 本地上传  还是七牛上传\n    type: {\n      type: String,\n      default: \"\",\n    },\n    // 唯一值\n    uuid: {\n      type: String,\n      default: \"\",\n    },\n    // 域名\n    domain: {\n      type: String,\n      default: \"\",\n    },\n\t\t// 本地存储路径\n\t\tsavePath: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t}\n  },\n  methods: {\n    /* 上传文件 */\n    handleChange() {\n      const [file] = this.$refs.file.files;\n      const flag = this.beforeUpload(file);\n\t\t\tthis.uploadFile(flag,file)\n    },\n\t\tuploadFile(flag,file){\n\t\t\t// 是否可以上传\n      if (flag) {\n        // 七牛\n        if (this.type === \"2\") {\n          this.qiniuUpload(this.uuid, file);\n        } else if (this.type === \"1\") {\n          this.initparams(file);\n          // 本地\n\t\t\t\t\tthis.defaultUpload(file)\n        }\n      }\n\t\t},\n    /* 点击\n     * 弹出选择文件框\n     */\n    handleClick() {\n      this.$refs.file.click();\n    },\n    /* 获取七牛的token\n     * @param {String} uuid 唯一值\n     * @param {String} fileName 文件名称\n     */\n    getQiniuToken(uuid, fileName) {\n      return this.$get(`/process/v1/getQnUploadToken/${uuid}`, {\n        fileName,\n      });\n    },\n\n    /*\n     * 七牛上传\n     * @param {String} uuid 唯一值\n     * @param {File} file 文件\n     */\n    async qiniuUpload(uuid, file) {\n\t\t\t// 域名后是否包含/\n\t\t\tconst domain = this.domain.slice(this.domain.length - 1,this.domain.length) === '/' ? this.domain : this.domain + '/'\n\n      // 获取token\n      const { data: token } = await this.getQiniuToken(uuid, file.name);\n      if (!token) return;\n      const that = this;\n\t\t\t\n      const observer = {\n        next(res) {\n          // 当前上传进度\n          that.$emit(\"progress\", res);\n\t\t\t\t\tthat.showProgress = true\n\t\t\t\t\tthat.progressWidth = res.total.percent + '%'\n        },\n        error(err) {\n          that.$emit(\"error\", err);\n        },\n        complete(res) {\n          that.$emit(\"change\", {\n            title: file.name,\n            url: domain + res.key,\n          });\n\t\t\t\t\tthat.showProgress = false\n        },\n      };\n      // 上传配置\n      const config = {\n        useCdnDomain: true,\n        region: qiniu.region.z1,\n      };\n      // 文件配置\n      const putExtra = {\n        fname: file.name,\n      };\n      const observable = qiniu.upload(file, file.name, token, putExtra, config);\n      // 上传开始\n      observable.subscribe(observer);\n    },\n    /* 转form 对象 */\n    setFormData(data) {\n      let params = new FormData();\n      if (data) {\n        Object.keys(data).forEach(function(key) {\n          params.append(key, data[key]);\n        });\n      }\n      return params;\n    } ,\n    /* 初始化参数 */\n    initparams(file){\n        //设置分片大小（单位Byte）\n        this.chunkParams.chunks = Math.ceil(file.size / this.bufferLength);\n        this.chunkParams = {\n          file:'', // 添加文件\n          chunks:Math.ceil(file.size / this.bufferLength), // 总块儿数\n          chunk:0, // 当前第几块儿\n          chunkSize:this.bufferLength, //当前块儿大小\n          name :file.name, //文件名\n          id:this.$uuid()  //文件 唯一标示\n        }\n    },\n    /* 递归上传 */\n    deepUpload(file,lastUpload){\n      //计算开始的切割点,idx是上传成功的分片数，未上传过文件则开始点为0\n      let start = this.chunkParams.chunk * this.bufferLength;\n      //计算分割的位置\n      let end = start + this.bufferLength;\n      //如果分割点超出文件大小，回退分割点\n      if (end > file.size) {end = file.size;}\n      this.chunkParams.file = file.slice(start, end);\n      let totalPercent = lastUpload ? lastUpload : 0;\n      this.$postPorm(\n                `/process/v1/fileUpload`,\n                this.setFormData(this.chunkParams),\n                //进度条的回调\n              (res)=>{\n                let temp = 0;\n                if(res.loaded === res.total){\n                  totalPercent += res.total\n                  temp = totalPercent\n\n                }else{\n                  temp = totalPercent + res.loaded\n                }\n                this.showProgress = true;\n        \t\t    this.progressWidth = (temp / file.size) * 100 + '%';\n              }\n            ).then(result=>{\n              if(result && result.data.code == 200){\n                if(result.data.data.url){\n                  const domain = this.domain.slice(this.domain.length - 1,this.domain.length) === '/' ? this.domain : this.domain + '/'\n                  this.$emit(\"change\", {\n                      title: file.name,\n                      url: domain + result.data.data.url,\n                    });\n                  this.showProgress = false\n                }else{\n                  this.deepUpload(file,totalPercent,++this.chunkParams.chunk)\n                }\n              }else{\n                this.$emit(\"error\", result.data.msg);\n                this.showProgress = false;\n              }\n          }).catch(err=>{\n              this.$emit(\"error\", '内部服务器错误');\n            })\n    },\n    /* 默认上传 */\n    async defaultUpload(file) {\n      if(file.size > this.bufferLength){\n        this.deepUpload(file)\n      }else{\n        const formdata = new FormData();\n        // 添加文件\n        formdata.append(\"file\", file);\n        // 添加参数 token\n        formdata.append(\"TOKEN\", sessionStorage.getItem(\"token\"));\n        // 本地保存路径\n        formdata.append('savePath',this.savePath)\n        const xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = () => {\n          // 如果完成\n          if (xhr.readyState === 4 && xhr.status === 200) {\n            const res = JSON.parse(xhr.response);\n        \t\tthis.$emit('change',res.data)\n        \t\tthis.showProgress = false\n          }\n        };\n        xhr.upload.onprogress = event => {\n        \tif (event.lengthComputable) {\n        \t\tconst percent = (event.loaded / event.total) * 100 + '%';\n        \t\tthis.showProgress = true\n        \t\tthis.progressWidth = percent\n        \t}\n        };\n        xhr.open(\"post\", baseURL + \"/process/v1/uploadFile\", true);\n        xhr.send(formdata);\n      }\n    },\n  },\n};\n</script>\n<style scoped lang=\"less\">\n\t.progress{\n\t\theight: 2px;\n\t\tbackground: #66cc3a;\n\t}\n</style>"]}]}